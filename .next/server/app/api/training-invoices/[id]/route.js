"use strict";(()=>{var e={};e.id=743,e.ids=[743],e.modules={5890:e=>{e.exports=require("better-sqlite3")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1017:e=>{e.exports=require("path")},2427:(e,i,n)=>{n.r(i),n.d(i,{headerHooks:()=>v,originalPathname:()=>f,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>_,staticGenerationAsyncStorage:()=>g,staticGenerationBailout:()=>m});var t={};n.r(t),n.d(t,{DELETE:()=>DELETE,GET:()=>GET,PUT:()=>PUT});var r=n(884),a=n(6132),o=n(5798),s=n(8307),c=n(1538),u=n(1045);let d=c.Ry({invoice_number:c.Z_().optional(),invoice_date:c.Z_().optional(),customer:c.Z_().optional(),training_name:c.Z_().min(1,"Training name is required").optional(),training_dates:c.IX(c.Ry({date:c.Z_().min(1,"Date is required"),start_time:c.Z_().min(1,"Start time is required"),end_time:c.Z_().min(1,"End time is required")})).min(1,"At least one date is required").optional(),trainer_costs:c.Rx().min(0,"Trainer costs must be non-negative").optional(),office_costs:c.Rx().min(0,"Office costs must be non-negative").optional(),margin_percentage:c.Rx().min(0,"Margin percentage must be non-negative").optional(),total_invoice_amount:c.Rx().min(0,"Total invoice amount must be non-negative").optional(),trainer_availability_emailed:c.O7().optional(),masterclass_planning_added:c.O7().optional(),lms_updated:c.O7().optional(),navara_event_agenda_updated:c.O7().optional(),catering_ordered:c.O7().optional(),trainer_invoice_received:c.O7().optional()});async function GET(e,{params:i}){try{let e=parseInt(i.id);if(isNaN(e))return o.Z.json({success:!1,error:"Invalid ID"},{status:400});let n=(0,s.N)(),t=n.getTrainingInvoiceById(e);if(!t)return o.Z.json({success:!1,error:"Training invoice not found"},{status:404});return o.Z.json({success:!0,data:t})}catch(e){return console.error("Error fetching training invoice:",e),o.Z.json({success:!1,error:"Failed to fetch training invoice"},{status:500})}}async function PUT(e,{params:i}){try{let n=parseInt(i.id);if(isNaN(n))return o.Z.json({success:!1,error:"Invalid ID"},{status:400});let t=await e.json(),r=d.parse(t),a=(0,s.N)(),c={...r};if(void 0!==r.training_dates){let e=Array.from(new Set(r.training_dates.map(e=>e.date)));c.duration_days=e.length}if(void 0!==r.trainer_costs||void 0!==r.office_costs||void 0!==r.margin_percentage){let e=a.getTrainingInvoiceById(n);if(!e)return o.Z.json({success:!1,error:"Training invoice not found"},{status:404});let i=r.trainer_costs??e.trainer_costs,t=r.office_costs??e.office_costs,s=r.margin_percentage??e.margin_percentage;c.total_invoice_amount=a.calculateTotalAmount(i,t,s)}let u=a.updateTrainingInvoice(n,c);if(!u)return o.Z.json({success:!1,error:"Training invoice not found"},{status:404});return o.Z.json({success:!0,data:u})}catch(e){if(console.error("Error updating training invoice:",e),e instanceof u.jm)return o.Z.json({success:!1,error:"Validation error",details:e.errors},{status:400});return o.Z.json({success:!1,error:"Failed to update training invoice"},{status:500})}}async function DELETE(e,{params:i}){try{let e=parseInt(i.id);if(isNaN(e))return o.Z.json({success:!1,error:"Invalid ID"},{status:400});let n=(0,s.N)(),t=n.deleteTrainingInvoice(e);if(!t)return o.Z.json({success:!1,error:"Training invoice not found"},{status:404});return o.Z.json({success:!0,message:"Training invoice deleted successfully"})}catch(e){return console.error("Error deleting training invoice:",e),o.Z.json({success:!1,error:"Failed to delete training invoice"},{status:500})}}let l=new r.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/training-invoices/[id]/route",pathname:"/api/training-invoices/[id]",filename:"route",bundlePath:"app/api/training-invoices/[id]/route"},resolvedPagePath:"C:\\Users\\wesle\\OneDrive\\Documenten\\Wesley code\\Finance\\src\\app\\api\\training-invoices\\[id]\\route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:p,staticGenerationAsyncStorage:g,serverHooks:_,headerHooks:v,staticGenerationBailout:m}=l,f="/api/training-invoices/[id]/route"}};var i=require("../../../../webpack-runtime.js");i.C(e);var __webpack_exec__=e=>i(i.s=e),n=i.X(0,[542,307],()=>__webpack_exec__(2427));module.exports=n})();