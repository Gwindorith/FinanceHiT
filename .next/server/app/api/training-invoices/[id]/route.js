"use strict";(()=>{var e={};e.id=743,e.ids=[743],e.modules={8802:e=>{e.exports=require("bcrypt")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8678:e=>{e.exports=import("pg")},253:(e,i,n)=>{n.a(e,async(e,t)=>{try{n.r(i),n.d(i,{headerHooks:()=>p,originalPathname:()=>g,requestAsyncStorage:()=>u,routeModule:()=>c,serverHooks:()=>l,staticGenerationAsyncStorage:()=>d,staticGenerationBailout:()=>_});var r=n(884),a=n(6132),o=n(6953),s=e([o]);o=(s.then?(await s)():s)[0];let c=new r.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/training-invoices/[id]/route",pathname:"/api/training-invoices/[id]",filename:"route",bundlePath:"app/api/training-invoices/[id]/route"},resolvedPagePath:"C:\\Users\\wesle\\OneDrive\\Documenten\\Wesley code\\Finance\\src\\app\\api\\training-invoices\\[id]\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:u,staticGenerationAsyncStorage:d,serverHooks:l,headerHooks:p,staticGenerationBailout:_}=c,g="/api/training-invoices/[id]/route";t()}catch(e){t(e)}})},6953:(e,i,n)=>{n.a(e,async(e,t)=>{try{n.r(i),n.d(i,{DELETE:()=>DELETE,GET:()=>GET,PUT:()=>PUT});var r=n(5798),a=n(5438),o=n(1538),s=n(1045),c=e([a]);a=(c.then?(await c)():c)[0];let u=o.Ry({invoice_number:o.Z_().optional(),invoice_date:o.Z_().optional(),customer:o.Z_().optional(),training_name:o.Z_().min(1,"Training name is required").optional(),training_dates:o.IX(o.Ry({date:o.Z_().min(1,"Date is required"),start_time:o.Z_().min(1,"Start time is required"),end_time:o.Z_().min(1,"End time is required"),room_rent_option_id:o.Rx().nullable().optional(),lunch_catering_option_id:o.Rx().nullable().optional(),dinner_catering_option_id:o.Rx().nullable().optional()})).min(1,"At least one date is required").optional(),trainer_costs:o.Rx().min(0,"Trainer costs must be non-negative").optional(),office_costs:o.Rx().min(0,"Office costs must be non-negative").optional(),margin_percentage:o.Rx().min(0,"Margin percentage must be non-negative").optional(),total_invoice_amount:o.Rx().min(0,"Total invoice amount must be non-negative").optional(),trainer_availability_emailed:o.O7().optional(),masterclass_planning_added:o.O7().optional(),lms_updated:o.O7().optional(),navara_event_agenda_updated:o.O7().optional(),catering_ordered:o.O7().optional(),trainer_invoice_received:o.O7().optional()});async function GET(e,{params:i}){try{let e=parseInt(i.id);if(isNaN(e))return r.Z.json({success:!1,error:"Invalid ID"},{status:400});let n=await (0,a.Nu)(e);if(!n)return r.Z.json({success:!1,error:"Training invoice not found"},{status:404});return r.Z.json({success:!0,data:n})}catch(e){return console.error("Error fetching training invoice:",e),r.Z.json({success:!1,error:"Failed to fetch training invoice"},{status:500})}}async function PUT(e,{params:i}){try{let n=parseInt(i.id);if(isNaN(n))return r.Z.json({success:!1,error:"Invalid ID"},{status:400});let t=await e.json(),o=u.parse(t),s={...o};if(void 0!==o.training_dates){let e=Array.from(new Set(o.training_dates.map(e=>e.date)));s.duration_days=e.length}if(void 0!==o.trainer_costs||void 0!==o.office_costs||void 0!==o.margin_percentage){let e=await (0,a.Nu)(n);if(!e)return r.Z.json({success:!1,error:"Training invoice not found"},{status:404});let i=o.trainer_costs??e.trainer_costs,t=o.office_costs??e.office_costs,c=o.margin_percentage??e.margin_percentage;s.total_invoice_amount=(0,a.p8)(i,t,c)}let c=await (0,a.fA)(n,s);if(!c)return r.Z.json({success:!1,error:"Training invoice not found"},{status:404});return r.Z.json({success:!0,data:c})}catch(e){if(console.error("Error updating training invoice:",e),e instanceof s.jm)return r.Z.json({success:!1,error:"Validation error",details:e.errors},{status:400});return r.Z.json({success:!1,error:"Failed to update training invoice"},{status:500})}}async function DELETE(e,{params:i}){try{let e=parseInt(i.id);if(isNaN(e))return r.Z.json({success:!1,error:"Invalid ID"},{status:400});let n=await (0,a.Jd)(e);if(!n)return r.Z.json({success:!1,error:"Training invoice not found"},{status:404});return r.Z.json({success:!0,message:"Training invoice deleted successfully"})}catch(e){return console.error("Error deleting training invoice:",e),r.Z.json({success:!1,error:"Failed to delete training invoice"},{status:500})}}t()}catch(e){t(e)}})}};var i=require("../../../../webpack-runtime.js");i.C(e);var __webpack_exec__=e=>i(i.s=e),n=i.X(0,[997,538,438],()=>__webpack_exec__(253));module.exports=n})();